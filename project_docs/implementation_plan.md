# UAV 도시 운용판정 대시보드 구현 계획

## 🎯 목표

**도시지역에서 드론 비행 가능 여부를 실시간으로 판정하는 대시보드**
- 4중 게이트 시스템 (Gate0~Gate4)
- Google Maps + 건물 높이 연동
- 실시간 기상 데이터 (Kp, 풍속, 시정)
- 기종별 GO/RESTRICT/NO-GO 판정

---

## 📊 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    UAV Urban Ops Dashboard                      │
├─────────────────────────────────────────────────────────────────┤
│  Frontend (React + Vite)                                        │
│  ├── Google Maps API (지도 + 건물 3D)                           │
│  ├── 게이트 상태 표시 (Gate0~4)                                  │
│  ├── 실시간 기상 정보 패널                                       │
│  └── 기종별 판정 테이블                                          │
├─────────────────────────────────────────────────────────────────┤
│  Backend (FastAPI)                                              │
│  ├── /api/evaluate - 4중 게이트 계산                            │
│  ├── /api/kp - NOAA Kp 지수                                     │
│  ├── /api/weather - Open-Meteo 기상                             │
│  ├── /api/metar - 공항 관측 교차확인                            │
│  └── /api/buildings - 건물 높이 정보                            │
├─────────────────────────────────────────────────────────────────┤
│  External APIs                                                  │
│  ├── NOAA SWPC (Kp 지수)                                        │
│  ├── Open-Meteo (풍속/돌풍/시정/강수)                           │
│  ├── AviationWeather (METAR)                                    │
│  ├── Google Maps Platform (지도/건물)                           │
│  └── 드론원스톱 (비행금지구역 - 수동체크)                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🚦 4중 게이트 시스템

### Gate0: 하드스탑 (법적/안전)
| 조건 | 판정 |
|------|------|
| 비행금지구역 | **NO-GO** |
| 인파 밀집 | **NO-GO** |
| 야간 (일몰 후) | **NO-GO** |
| 비 또는 눈 | **NO-GO** |

### Gate1: 위성/통신 품질
| 조건 | 판정 |
|------|------|
| GPS 잠금 < 8 | **NO-GO** |
| GLONASS < 4 | **RESTRICT** |

### Gate2: 시정/가시성
| 조건 | 판정 |
|------|------|
| 시정 < 1km | **NO-GO** |
| 시정 1~3km | **RESTRICT** |
| 시정 > 3km | **GO** |

### Gate3: 풍속/돌풍 (도시보정 적용)
```
EWS = 예보풍속 × Fcanyon × α × GF

Fcanyon = 1 + 0.3 × (H/W)  (도시 협곡 계수)
α = 1.2 (도시 거칠기)
GF = 1.3 (오차 버퍼)
```

| EWS (m/s) | 경량(<2kg) | 중형(2-25kg) | 대형(>25kg) |
|-----------|-----------|-------------|-------------|
| < 5 | GO | GO | GO |
| 5-8 | RESTRICT | GO | GO |
| 8-10 | NO-GO | RESTRICT | GO |
| > 10 | NO-GO | NO-GO | RESTRICT |

### Gate4: 층별풍 (5m 간격)
| 고도 | 풍속 계수 |
|------|----------|
| 5m | 0.6 |
| 10m | 0.75 |
| 20m | 0.9 |
| 30m | 1.0 |
| 50m | 1.15 |

---

## 📂 파일 구조

```
드론 용/
├── backend/
│   ├── main.py              # FastAPI 메인
│   ├── models.py            # Pydantic 모델
│   ├── gates.py             # 4중 게이트 계산
│   ├── weather_api.py       # 기상 API 연동
│   ├── buildings_api.py     # 건물 높이 API
│   ├── requirements.txt
│   └── Dockerfile
├── frontend/
│   ├── src/
│   │   ├── App.jsx          # 메인 앱
│   │   ├── components/
│   │   │   ├── MapView.jsx      # Google Maps
│   │   │   ├── GateStatus.jsx   # 게이트 상태
│   │   │   ├── WeatherPanel.jsx # 기상 정보
│   │   │   ├── DroneTable.jsx   # 기종별 판정
│   │   │   └── InputForm.jsx    # 입력 폼
│   │   ├── hooks/
│   │   │   └── useWeather.js    # 기상 훅
│   │   └── utils/
│   │       └── gates.js         # 게이트 계산
│   ├── index.html
│   ├── package.json
│   └── vite.config.js
├── docker-compose.yml
├── .env.example
└── README.md
```

---

## 🔌 외부 API 연동

### 1. NOAA SWPC (Kp 지수)
```
GET https://services.swpc.noaa.gov/json/planetary_k_index_1m.json
```

### 2. Open-Meteo (기상)
```
GET https://api.open-meteo.com/v1/forecast
?latitude={lat}&longitude={lon}
&current=temperature,wind_speed_10m,wind_gusts_10m,visibility,precipitation
```

### 3. AviationWeather (METAR)
```
GET https://aviationweather.gov/api/data/metar
?ids={station}&format=json
```

### 4. Google Maps Platform
- Maps JavaScript API (지도 표시)
- Places API (건물 정보)
- Elevation API (고도)

---

## 🖥️ UX 디자인

```
┌─────────────────────────────────────────────────────────────┐
│  🚁 UAV 도시 운용판정 대시보드                               │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌─────────────────────────────┐  │
│  │                     │  │ 📍 위치: 서울 강남구        │  │
│  │    Google Maps      │  │ 🌡️ 풍속: 5.2 m/s           │  │
│  │    (3D 건물)        │  │ 💨 돌풍: 8.1 m/s           │  │
│  │                     │  │ 👁️ 시정: 12 km            │  │
│  │   [클릭으로 위치    │  │ 🌧️ 강수: 10%              │  │
│  │    선택]            │  │ 📡 Kp: 3                   │  │
│  └─────────────────────┘  └─────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Gate0  Gate1  Gate2  Gate3  Gate4                   │   │
│  │  🟢     🟢     🟡     🟢     🟢                     │   │
│  │ PASS   PASS   WARN   PASS   PASS                    │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 기종별 판정                                          │   │
│  │ ┌──────────┬─────┬─────────┬────────┐               │   │
│  │ │ 구분     │경량 │ 중형    │ 대형   │               │   │
│  │ ├──────────┼─────┼─────────┼────────┤               │   │
│  │ │ 돌풍한계 │8m/s │ 12m/s   │ 15m/s  │               │   │
│  │ ├──────────┼─────┼─────────┼────────┤               │   │
│  │ │ 판정     │ 🟡  │  🟢     │  🟢    │               │   │
│  │ │          │REST │  GO     │  GO    │               │   │
│  │ └──────────┴─────┴─────────┴────────┘               │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 층별풍 (5m 간격)                                     │   │
│  │ 5m: 3.1m/s │ 10m: 3.9m/s │ 20m: 4.7m/s │ 30m: 5.2m/s │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## ✅ 구현 우선순위

### Phase 1: 백엔드 API (1일)
- [x] FastAPI 프로젝트 구조
- [ ] Gate 계산 로직 구현
- [ ] NOAA Kp API 연동
- [ ] Open-Meteo API 연동
- [ ] METAR API 연동

### Phase 2: 프론트엔드 기본 (1일)
- [ ] React + Vite 설정
- [ ] Google Maps 연동
- [ ] 기상 정보 패널
- [ ] 게이트 상태 표시

### Phase 3: 통합 및 건물 연동 (1일)
- [ ] 지도 클릭 → 위치 선택
- [ ] 건물 높이 표시
- [ ] 기종별 판정 테이블
- [ ] 층별풍 계산

### Phase 4: PWA 및 최적화
- [ ] PWA 설정 (홈화면 설치)
- [ ] 오프라인 지원
- [ ] 모바일 최적화

---

## 🔐 필요 API 키

```env
# Google Maps
GOOGLE_MAPS_API_KEY=your_key

# (선택) 한국투자증권 - 날씨 백업
# (선택) 기상청 API
```

> **참고**: NOAA, Open-Meteo, AviationWeather는 무료 공개 API

---

**이 계획대로 구현을 시작할까요?**
